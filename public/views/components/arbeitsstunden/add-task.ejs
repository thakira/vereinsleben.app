<%- include('../../partials/header/header') %>
<main class="container-fluid edit-page">

    <nav class="navbar sticky-top navbar-dark bg-primary row">
        <div class="container-left">
            <a type="button" class="close btn" href="/arbeitsstunden">
                <span class="material-icons">close</span>
            </a>
            <h3>Erstelle eine neue Aufgabe</h3>
        </div>
    </nav>


    <div id="editorContainer" class="col">

        <form method="post" action="/add-task" id="addTaskForm">

            <div class="form-group">
                <label for="taskTitle" class="bmd-label-floating">Aufgaben-Titel *</label>
                <input type="text" class="form-control" id="taskTitle" name="taskTitle" required>
            </div>

            <div class="form-group">
                <label for="taskDescription" class="bmd-label-floating">Beschreibung (optional)</label>
                <textarea class="form-control" id="taskDescription" name="taskDescription"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group col-md-4">
                    <label for="taskEstimated" class="bmd-label-floating">Geschätzter Aufwand (Std./Person) *</label>
                    <input type="number" class="form-control" id="taskEstimated" name="taskEstimated" value="1"></input>
                </div>

                <div class="form-group col-md-4">
                    <label for="taskHeadcount" class="bmd-label-floating">Notwendige Personenzahl *</label>
                    <input type="number" class="form-control" id="taskHeadcount" name="taskHeadcount" value="1"></input>
                </div>

                <div class="form-group col-md-4">
                    <label for="taskDate" class="">Festes Datum für die Aufgabe</label>
                    <input type="datetime-local" class="form-control" id="taskDate" name="taskDate"></input>
                </div>
            </div>

            <button type="submit" id="submitButton" class="btn btn-primary">Abschicken</button>
        </form>
    </div>
</main>

<script>
    let flag = false;
    let flag2 = false;
    $('#submitButton').on('click', function() {
        $('#addTaskForm').submit(function(e) {
            e.preventDefault();
            if (!flag && "caches" in window) {
                flag = true;
                console.log("cache verfügbar")
                caches.open('CACHE_DYNAMIC_NAME')
                    .then(cache => {
                        cache.delete('/arbeitsstunden')
                        console.log("irgendwas ist passiert")
                    })
                    .then(function() {
                        $('#addTaskForm').submit()
                        console.log("nach addTaskForm")
                    })
            } else if (!flag2){
                flag2 = true;
                console.log("kein Cache")
                $('#addTaskForm').submit()
            }
        })
    })

</script>

<%- include('../../partials/footer/footer') %>