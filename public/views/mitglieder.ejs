<%- include('partials/header/header') %>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css"/>
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.5/css/responsive.dataTables.min.css"/>
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css"/>
<link rel="stylesheet" href="./assets/datatables/dt-editor/css/editor.dataTables.min.css"/>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.5/js/dataTables.responsive.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>

<script type="text/javascript" src="./assets/datatables/dt-editor/js/dataTables.editor.min.js"></script>

<script>
    $(document).ready( function () {
        var editor = new $.fn.dataTable.Editor( {
            table: '#userTable',
            fields: [
                { label: 'Vorname', name: 'firstname' },
                { label: 'Nachname',  name: 'lastname' },
                { label: 'Mobil',  name: 'mobile' },
                { label: 'Telefon',  name: 'phone' },
                { label: 'E-Mail',  name: 'email' },
                { label: 'Geburtstag',  name: 'birthday' },
                { label: 'Arbeitsstunden',  name: 'workhours' },
                { label: 'Mitglieds-Nr.',  name: 'memberNumber' },
                { label: 'Rechte',  name: 'role' }
            ]
        } );
        $('#userTable').DataTable({
            language: {
                url: "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/German.json"
            },
            responsive: {
                details: true
            },
            select: true,
            dom: 'Bfrtip',
            columns: [
                { data: 'firstname' },
                { data: 'lastname' },
                { data: 'mobile' },
                { data: 'phone' },
                { data: 'email' },
                { data: 'birthday' },
                { data: 'workhours' },
                { data: 'memberNumber' },
                { data: 'role' },
                { data: 'registered' }
            ],
            buttons: [
                { extend: 'edit',   editor: editor },
                { extend: 'remove', editor: editor }
            ]
        });

    } );
</script>

<main>
    <div class="card tableContainer">
        <table id="userTable" class="display dt-responsive nowrap" width="100%" data-page-length="25">
            <thead>
            <tr>
                <th>Vorname</th>
                <th>Nachname</th>
                <th>Mobil</th>
                <th>Telefon</th>
                <th>E-Mail</th>
                <th>Geburtstag</th>
                <th>Arbeitsstunden</th>
                <th>Mitglieds-Nr.</th>
                <th>Rechte</th>
                <th>Registriert seit</th>
            </tr>
            </thead>
            <tbody>
            <% users.forEach( (user) => { %>
                <tr id="<%= user._id.$oid %>">
                    <td><%= user.firstname%></td>
                    <td><%= user.lastname%></td>
                    <td><%= user.mobile%></td>
                    <td><%= user.phone%></td>
                    <td><a href="mailto:<%= user.email%>"><%= user.email%></a></td>
                    <td><%= user.birthday%></td>
                    <td><%= user.worked%>/<%= user.workhours%></td>
                    <td><% if(user.memberNumber) {%>
                            <%= user.memberNumber%>
                        <% } else {%>
                            xxxx
                        <% }%>
                    </td>
                    <td><%= user.role%></td>
                    <td>
                        <%= new Date(user.createdAt.$date).getDate().toString().length < 2
                                ? "0"+new Date(user.createdAt.$date).getDate()
                                : new Date(user.createdAt.$date).getDate()%>.<%= new Date(user.createdAt.$date).getMonth().toString().length < 2
                                ? "0"+ (new Date(user.createdAt.$date).getMonth() + 1)
                                : new Date(user.createdAt.$date).getMonth().toString()%>.<%= new Date(user.createdAt.$date).getFullYear() %>
                    </td>
                </tr>
            <% }) %>
            </tbody>
        </table>

    </div>
</main>

<% if(user.role === "admin") { %>
  <%- include('components/buttons/floating-add', {dataTarget:"mitgliederModal"}) %>
<% } %>

<%- include('partials/footer/footer') %>