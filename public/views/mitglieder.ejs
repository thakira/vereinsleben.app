<%- include('partials/header/header') %>
<!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
<link rel="stylesheet" href="https://unpkg.com/formiojs@latest/dist/formio.full.min.css">-->
<script src="https://unpkg.com/formiojs@latest/dist/formio.full.min.js"></script>

<script>

    function getMembersPromise() {
        return new Promise((resolve, reject) => {
            fetch('http://localhost:3000/getMemberData')
                .then((response) => response.json())
                .then((json) => {
                    let allMembers = json.data.members;
                    resolve(allMembers);
                })
                .catch((error) => {
                    console.error(error);
                    reject(error);
                });
        });
    }


 </script>


<main>
    <div class="card tableContainer">
        <div id="formio"></div>
    </div>
</main>
<script>
    Formio.createForm(document.getElementById('formio'), {
    components: [
        {
            label: "",
            key: 'members',
            type: 'editgrid',
            input: true,
            templates: {
                header: '' +
                        '<div class="row">' +
                        '  {% util.eachComponent(components, function(component) { %} ' +
                        '    <div class="col-sm-2">' +
                        '      <strong>{{ component.label }}</strong>' +
                        '    </div>' +
                        '  {% }) %}' +
                        '</div>',
                row: '' +
                        '<div class="row">' +
                        '  {%util.eachComponent(components, function(component) { %}' +
                        '    <div class="col-sm-2">' +
                        '      {{ row[component.key] }}' +
                        '    </div>' +
                        '  {% }) %}' +
                        '  <div class="col-sm-2">' +
                        '    <div class="btn-group pull-right">' +
                        '      <div class="btn btn-default btn-sm editRow"><i class="fa fa-edit"></i></div>' +
                        '      <div class="btn btn-danger btn-sm removeRow"><i class="fa fa-trash"></i></div>' +
                        '    </div>' +
                        '  </div>' +
                        '</div>',
                footer: ''
            },
            components: [
                {
                    label: 'Vorname',
                    key: 'firstname',
                    type: 'textfield',
                    input: true
                },
                {
                    label: 'Nachname',
                    key: 'lastname',
                    type: 'textfield',
                    input: true
                },
                {
                    label: 'Mobil',
                    key: 'mobile',
                    type: 'textfield',
                    input: true
                },
                {
                    label: 'Telefon',
                    key: 'phone',
                    type: 'textfield',
                    input: true
                },
                {
                    label: 'E-Mail',
                    key: 'email',
                    type: 'textfield',
                    input: true
                },
                {
                    label: 'Geburtstag',
                    key: 'birthday',
                    type: 'datetime',
                    input: true,
                    format: 'dd.MM.yyyy',
                    enableDate: true,
                    enableTime: false,
                    defaultDate: '',
                    datepickerMode: 'day',
                    datePicker: {
                        showWeeks: true,
                        startingDay: 0,
                        initDate: '',
                        minMode: 'day',
                        maxMode: 'year',
                        yearRows: 4,
                        yearColumns: 5,
                        datepickerMode: 'day'
                    },
                },
                    {
                    label: 'Arbeitsstunden',
                    key: 'worked',
                    type: 'number',
                    input: false
                    },
                {
                    label: 'Mitglieds-Nr.',
                    key: 'memberNumber',
                    type: 'number',
                    input: true
                },
                {
                    label: "Rechte",
                    data: {
                        values: [
                            {
                                "label": "User",
                                "value": "user"
                            },
                            {
                                "label": "Trainer",
                                "value": "trainer"
                            },
                            {
                                "label": "Admin",
                                "value": "admin"
                            }
                        ]
                    },
                    dataType: "string",
                    searchEnabled: false,
                    key: "role",
                    type: "select",
                    input: false,
                    defaultValue: "user"
                },
                    {
                    label: 'registriert seit',
                    key: 'createdAt',
                    input: false,
                    type: 'day',
                    format: 'dd.MM.yyyy',

                }
            ]
        }
    ]
    }).then(async function(form) {
        // Provide a default submission.
        form.submission = {
            data: {
                members:
                    await getMembersPromise()
            }
        };
        form.on('saveRow', function(submission) {
            console.log('Submission was made!', submission);
        });
    });

</script>



<%- include('partials/footer/footer') %>